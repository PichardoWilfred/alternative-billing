<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alternative billing</title>
    <link rel="stylesheet" href="./styles/reset.css" />
    <link rel="stylesheet" href="./styles/overwritting.css" />
    <link rel="stylesheet" href="./styles/commons.css" />
    <link rel="stylesheet" href="./styles/styles.css"  />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://unpkg.com/minibarjs@latest/dist/minibar.min.css" rel="stylesheet" type="text/css">
    <script src="https://unpkg.com/minibarjs@latest/dist/minibar.min.js" type="text/javascript"></script>
    <script type="module" src="./js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ryangjchandler/alpine-mask@0.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
    <div class="container" x-data="store">
        <nav class="main non-printable">
            <button class="search">
                <i class="fa-solid fa-magnifying-glass"></i>
            </button>
            <button @click="addTable()" class="add-table">
                <img src="./assets/add-table.svg" alt="" srcset="">
            </button>
            <div class="popup-container">
                <button class="options" @click="() => { popup.visible = true }">
                    <i class="fa-solid fa-gear"></i>
                </button>
                <ul x-show="popup.visible" class="pop-up" @click.outside="() => {popup.visible = false}" x-transition.opacity x-cloak>
                    <li @click="open_modal('Reiniciar aplicación', '¿Estás seguro de que deseas reiniciar la aplicación? En este caso, se <b>borrarán todos los datos que tienes almacenados </b> hasta ahora.', [''], 'reset')">
                        <i class="fa-solid fa-arrows-rotate"></i>
                        <span>
                            Reiniciar aplicación
                        </span>
                    </li>
                    <!-- <li>
                        <i class="fa-solid fa-sliders"></i>
                        <span>
                            Configuración
                        </span>
                    </li> -->
                </ul>
            </div>
        </nav> <!-- delete modal -->
        <div x-show="modal.visible" class="modal-container" x-transition.opacity x-cloak>
            <div class="modal-body">
                <div class="header">
                    <h4 x-text="modal.title"></h4>
                    <button type="button" class="close" @click="modal.visible = false">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="content">
                    <p class="modal-text" x-html="modal.message_text()"></p>
                </div>
                <div class="footer">
                    <button type="button" class="cancel-modal" @click="modal.visible = false">
                        Cancelar
                    </button>
                    <button type="button" class="accept" @click="() => { modal_action(modal.action) }">Aceptar</button>
                </div>
            </div>
            <div class="modal-mask" @click="modal.visible = false"></div>
        </div>
        <template x-if="tables.length >= 1">
            <main>
                <header class="non-printable">
                    <ul class="table-list">
                        <template x-for="(table, index) in tables" :key="table.id">
                            <li :class="table.id === selectedTable.id && 'selected'" @click="() => {selectTable(table)}">
                                <span x-text="table.label" class="text-truncate"></span>
                            </li>
                        </template>
                    </ul>
                </header>
                <div class="card" :class="selectedTable.quantities.length === 0 && 'no-quantities'">
                    <div class="card-header">
                        <input type="text" class="table-name" 
                            x-model="selectedTable.label"
                            @click="() => { focus_label() }"
                            @click.outside="() => { saveLabel($el) }"
                            @keydown.enter.prevent="() => { saveLabel($el) }"
                            maxlength="15"
                        >
                        <button type="button" class="print-table non-printable" @click="print">
                            <i class="fa-solid fa-print"></i>
                        </button>
                        <button type="button" class="delete-table non-printable" @click="() => { open_modal('Eliminar tabla','¿Está seguro de que desea eliminar la tabla <b>{0}</b> ?',[selectedTable.label], 'delete') }">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                    <template x-if="selectedTable.quantities.length === 0">
                        <div class="no-quantities-container non-printable">
                            <img src="./assets/not-found-quantities.svg" alt="" srcset="">
                            <h1>
                                Esta tabla aun no tiene items agregados
                            </h1>
                        </div>
                    </template>
                    <template x-if="selectedTable.quantities.length !== 0">.card-header
                        <ul class="table" @click.outside="() => { unselect_all() }">
                            <template x-for="(quantity, index) in selectedTable.quantities" :key="index">
                                <li class="quantity" :key="index"
                                    @click.outside="() => { saveQuantity('unfocused', index, $el); }"
                                    :class="is_selected(index) && 'selected'"
                                    @mousedown="enable_select(index)" @touchstart="enable_select(index)"
                                    @mouseup="() => {cancel_select() }" @mouseleave="() => {cancel_select() }" 
                                    @touchend="() => {cancel_select() }"
                                    @click="toggle_select(index)">
    
                                    <input :id="`quantity-name-${index}`" class="name"
                                    type="text"
                                    x-model="quantity.name"
                                    @click="() => { focus_quantity(index, 'name') }"
                                    :disabled="select_mode"
                                    @keydown.enter.prevent="saveQuantity('enter', index, $el)"
                                    >
                                    <input :id="`quantity-value-${index}`" class="value"
                                    type="number"
                                    :disabled="select_mode"
                                    x-model="quantity.value"
                                    @click="() => { focus_quantity(index, 'value') }"
                                    @keydown.enter.prevent="saveQuantity('enter', index, $el)"
                                    >
                                    <template x-if="select_mode">
                                        <div class="select-indicator">
                                            <template x-if="!is_selected(index)">
                                                <i class="fa-regular fa-circle"></i>
                                            </template>
                                            <template x-if="is_selected(index)">
                                                <i class="fa-solid fa-circle-check"></i>
                                            </template>
                                        </div>
                                    </template>
                                </li>
                            </template>                        
                        </ul>
                    </template>
                </div>
            </main>
        </template>
        <template x-if="tables.length === 0">
            <main class="not-found">
                <img src="assets/not-found-alt-bill.svg" class="not-found-img" alt="" srcset="">
                <h4>No pudimos encontrar ninguna tabla en esta sesión.</h4>
            </main>
        </template>
        <div class="table-sum">
            <div class="info">
                <template x-if="select_mode && !error.visible">
                    <button class="delete-items" @click="remove_selected_items()">
                        <i class="fa-solid fa-xmark"></i>
                        Eliminar item
                    </button>
                </template>
                <template x-if="error.visible">
                    <span x-text="error.label" class="error-label"></span>
                </template>
                <div class="total">
                    <h4 class="label">TOTAL:</h4>
                    <h3 class="value" x-text="total"></h3>
                </div>
            </div>
            <div class="new-quantity non-printable" :class="tables.length === 0 && 'disabled'">
                <input
                x-ref="new_quantity"
                x-model="new_quantity"
                x-mask.numeral
                @click="() => { focus_newQuantity() }"
                @keydown.enter.prevent="saveNewQuantity($el)">
                <button type="button" @click="() => { saveNewQuantity($refs.new_quantity) }">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
</body>
<style></style>
<script type="module"></script>
</html>

